local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local GuiService = game:GetService("GuiService")
local Lighting = game:GetService("Lighting")

local ViewportSize = workspace.CurrentCamera.ViewportSize
local IsMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

local function Create(className, properties)
    local instance = Instance.new(className)
    for k, v in pairs(properties) do
        instance[k] = v
    end
    return instance
end

local Theme = {
    Background = Color3.fromRGB(15, 15, 17),
    Sidebar = Color3.fromRGB(20, 20, 22),
    Element = Color3.fromRGB(25, 25, 27),
    Hover = Color3.fromRGB(35, 35, 38),
    Active = Color3.fromRGB(45, 45, 50),
    Text = Color3.fromRGB(240, 240, 240),
    SubText = Color3.fromRGB(160, 160, 160),
    Accent = Color3.fromRGB(0, 160, 255),
    AccentDark = Color3.fromRGB(0, 120, 200),
    Stroke = Color3.fromRGB(50, 50, 55),
    Success = Color3.fromRGB(100, 255, 100),
    Error = Color3.fromRGB(255, 80, 80),
    Warning = Color3.fromRGB(255, 200, 80)
}

local Library = {
    Version = "4.0.0",
    Options = {},
    Unloaded = false,
    OpenFrames = {},
    MinimizeKey = Enum.KeyCode.RightControl,
    Minimized = false,
    ScreenGui = nil,
    MainFrame = nil
}

-- Animation Utilities
local function Tween(obj, info, goal, callback)
    if not obj or not obj.Parent then return end
    local tweenInfo = TweenInfo.new(
        info[1] or 0.3,
        info[2] or Enum.EasingStyle.Quint,
        info[3] or Enum.EasingDirection.Out,
        info[4] or 0,
        info[5] or false,
        info[6] or 0
    )
    local t = TweenService:Create(obj, tweenInfo, goal)
    if callback then
        t.Completed:Connect(callback)
    end
    t:Play()
    return t
end

local function AddHoverEffect(element, hoverColor, normalColor)
    hoverColor = hoverColor or Theme.Hover
    normalColor = normalColor or Theme.Element
    
    element.MouseEnter:Connect(function()
        Tween(element, {0.2}, {BackgroundColor3 = hoverColor})
    end)
    
    element.MouseLeave:Connect(function()
        Tween(element, {0.2}, {BackgroundColor3 = normalColor})
    end)
end

local function MakeDraggable(frame, handle)
    local dragging, dragInput, dragStart, startPos
    
    local function UpdatePosition(input)
        local delta = input.Position - dragStart
        local newPos = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
        Tween(frame, {0.1}, {Position = newPos})
    end
    
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            UpdatePosition(input)
        end
    end)
end

-- HSV to RGB conversion
local function HSVtoRGB(h, s, v)
    local r, g, b
    local i = math.floor(h * 6)
    local f = h * 6 - i
    local p = v * (1 - s)
    local q = v * (1 - f * s)
    local t = v * (1 - (1 - f) * s)
    i = i % 6
    if i == 0 then r, g, b = v, t, p
    elseif i == 1 then r, g, b = q, v, p
    elseif i == 2 then r, g, b = p, v, t
    elseif i == 3 then r, g, b = p, q, v
    elseif i == 4 then r, g, b = t, p, v
    elseif i == 5 then r, g, b = v, p, q
    end
    return Color3.new(r, g, b)
end

-- RGB to HSV conversion
local function RGBtoHSV(color)
    local r, g, b = color.R, color.G, color.B
    local max, min = math.max(r, g, b), math.min(r, g, b)
    local h, s, v
    v = max
    local d = max - min
    if max == 0 then s = 0 else s = d / max end
    if max == min then
        h = 0
    else
        if max == r then
            h = (g - b) / d
            if g < b then h = h + 6 end
        elseif max == g then
            h = (b - r) / d + 2
        elseif max == b then
            h = (r - g) / d + 4
        end
        h = h / 6
    end
    return h, s, v
end

function Library:CreateWindow(Config)
    if CoreGui:FindFirstChild("CeriumUI") then
        CoreGui.CeriumUI:Destroy()
    end
    
    warn("[+] CERIUM UI v" .. Library.Version .. " | Enhanced Edition")
    if IsMobile then
        warn("[+] Mobile Mode Enabled")
    end

    local ScreenGui = Create("ScreenGui", {
        Name = "CeriumUI",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        IgnoreGuiInset = true,
        ResetOnSpawn = false
    })
    Library.ScreenGui = ScreenGui

    -- Main Frame with opening animation
    local windowSize = Config.Size or (IsMobile and UDim2.fromOffset(math.min(ViewportSize.X - 40, 650), math.min(ViewportSize.Y - 100, 400)) or UDim2.fromOffset(700, 450))
    
    local MainFrame = Create("Frame", {
        Name = "MainFrame",
        Parent = ScreenGui,
        BackgroundColor3 = Theme.Background,
        Position = UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.fromOffset(0, 0),
        ClipsDescendants = true,
        BackgroundTransparency = 1
    })
    Library.MainFrame = MainFrame
    Create("UICorner", {Parent = MainFrame, CornerRadius = UDim.new(0, 12)})
    Create("UIStroke", {Parent = MainFrame, Color = Theme.Stroke, Thickness = 1, Transparency = 1})
    
    -- Drop Shadow
    local Shadow = Create("ImageLabel", {
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, -15, 0, -15),
        Size = UDim2.new(1, 30, 1, 30),
        ZIndex = -1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277)
    })
    
    -- Opening Animation
    task.spawn(function()
        task.wait(0.05)
        Tween(MainFrame, {0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out}, {
            Size = windowSize,
            BackgroundTransparency = 0
        })
        Tween(MainFrame:FindFirstChildOfClass("UIStroke"), {0.4}, {Transparency = 0})
    end)

    MakeDraggable(MainFrame, MainFrame)

    -- Sidebar
    local sidebarWidth = IsMobile and 150 or 180
    local Sidebar = Create("Frame", {
        Parent = MainFrame,
        BackgroundColor3 = Theme.Sidebar,
        Size = UDim2.new(0, sidebarWidth, 1, 0),
        BorderSizePixel = 0
    })
    Create("UICorner", {Parent = Sidebar, CornerRadius = UDim.new(0, 12)})
    
    -- Sidebar corner fix
    Create("Frame", {
        Parent = Sidebar,
        BackgroundColor3 = Theme.Sidebar,
        Size = UDim2.new(0, 12, 1, 0),
        Position = UDim2.new(1, -12, 0, 0),
        BorderSizePixel = 0
    })
    
    -- Sidebar border
    Create("Frame", {
        Parent = Sidebar,
        BackgroundColor3 = Theme.Stroke,
        Size = UDim2.new(0, 1, 1, 0),
        Position = UDim2.new(1, 0, 0, 0),
        BorderSizePixel = 0
    })

    -- Title Section
    local TitleContainer = Create("Frame", {
        Parent = Sidebar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 15, 0, 15),
        Size = UDim2.new(1, -30, 0, 40)
    })
    
    local TitleLabel = Create("TextLabel", {
        Parent = TitleContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 22),
        Font = Enum.Font.GothamBold,
        Text = Config.Title or "Cerium",
        TextColor3 = Theme.Text,
        TextSize = IsMobile and 14 or 16,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local SubTitleLabel = Create("TextLabel", {
        Parent = TitleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 22),
        Size = UDim2.new(1, 0, 0, 15),
        Font = Enum.Font.Gotham,
        Text = Config.SubTitle or "",
        TextColor3 = Theme.SubText,
        TextSize = IsMobile and 10 or 12,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    -- Minimize Button
    local MinimizeBtn = Create("TextButton", {
        Parent = MainFrame,
        BackgroundColor3 = Theme.Element,
        Position = UDim2.new(1, -35, 0, 10),
        Size = UDim2.new(0, 25, 0, 25),
        Text = "âˆ’",
        Font = Enum.Font.GothamBold,
        TextColor3 = Theme.Text,
        TextSize = 18,
        AutoButtonColor = false
    })
    Create("UICorner", {Parent = MinimizeBtn, CornerRadius = UDim.new(0, 6)})
    AddHoverEffect(MinimizeBtn)
    
    MinimizeBtn.MouseButton1Click:Connect(function()
        Library:ToggleMinimize()
    end)

    -- Search Box
    local SearchFrame = Create("Frame", {
        Parent = Sidebar,
        BackgroundColor3 = Color3.fromRGB(12, 12, 14),
        Position = UDim2.new(0, 10, 0, 65),
        Size = UDim2.new(1, -20, 0, IsMobile and 28 or 32)
    })
    Create("UICorner", {Parent = SearchFrame, CornerRadius = UDim.new(0, 8)})
    Create("UIStroke", {Parent = SearchFrame, Color = Theme.Stroke, Thickness = 1})
    
    local SearchIcon = Create("TextLabel", {
        Parent = SearchFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(0, 20, 1, 0),
        Font = Enum.Font.Gotham,
        Text = "ðŸ”",
        TextColor3 = Theme.SubText,
        TextSize = 12
    })

    local SearchBox = Create("TextBox", {
        Parent = SearchFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -30, 1, 0),
        Position = UDim2.new(0, 28, 0, 0),
        Font = Enum.Font.Gotham,
        PlaceholderText = "Search...",
        Text = "",
        TextColor3 = Theme.Text,
        PlaceholderColor3 = Theme.SubText,
        TextSize = IsMobile and 11 or 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false
    })

    -- Tab Container
    local TabContainer = Create("ScrollingFrame", {
        Parent = Sidebar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, IsMobile and 100 or 110),
        Size = UDim2.new(1, -20, 1, IsMobile and -110 or -120),
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = Theme.Accent,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollingDirection = Enum.ScrollingDirection.Y
    })
    Create("UIListLayout", {
        Parent = TabContainer,
        Padding = UDim.new(0, 6),
        SortOrder = Enum.SortOrder.LayoutOrder
    })

    -- Search functionality
    SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
        local input = SearchBox.Text:lower()
        for _, child in pairs(TabContainer:GetChildren()) do
            if child:IsA("TextButton") then
                local label = child:FindFirstChild("TextLabel")
                if label then
                    local tabName = label.Text:lower()
                    local shouldShow = input == "" or string.find(tabName, input)
                    if shouldShow then
                        child.Visible = true
                        Tween(child, {0.2}, {BackgroundTransparency = 0})
                    else
                        Tween(child, {0.2}, {BackgroundTransparency = 1})
                        task.delay(0.2, function()
                            if not (input == "" or string.find(tabName, input:lower())) then
                                child.Visible = false
                            end
                        end)
                    end
                end
            end
        end
    end)

    -- Content Holder
    local ContentHolder = Create("Frame", {
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, sidebarWidth + 1, 0, 0),
        Size = UDim2.new(1, -sidebarWidth - 1, 1, -30),
        ClipsDescendants = true
    })

    -- Version Label
    Create("TextLabel", {
        Parent = Sidebar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 15, 1, -25),
        Size = UDim2.new(1, -30, 0, 20),
        Font = Enum.Font.GothamBold,
        Text = "v" .. Library.Version,
        TextColor3 = Theme.SubText,
        TextSize = 10,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    -- Time Label
    local TimeLabel = Create("TextLabel", {
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -130, 1, -28),
        Size = UDim2.new(0, 120, 0, 20),
        Font = Enum.Font.Gotham,
        Text = "00:00:00",
        TextColor3 = Theme.SubText,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Right
    })

    task.spawn(function()
        while MainFrame.Parent do
            TimeLabel.Text = os.date("%I:%M:%S %p")
            task.wait(1)
        end
    end)

    -- Notification System
    local NotifyHolder = Create("Frame", {
        Parent = ScreenGui,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, IsMobile and 280 or 320, 1, -40),
        Position = UDim2.new(1, IsMobile and -290 or -340, 0, 20),
        ZIndex = 100
    })
    Create("UIListLayout", {
        Parent = NotifyHolder,
        Padding = UDim.new(0, 10),
        VerticalAlignment = Enum.VerticalAlignment.Bottom,
        SortOrder = Enum.SortOrder.LayoutOrder
    })

    function Library:Notify(NotifyConfig)
        local typeColors = {
            info = Theme.Accent,
            success = Theme.Success,
            warning = Theme.Warning,
            error = Theme.Error
        }
        
        local accentColor = typeColors[NotifyConfig.Type] or Theme.Accent
        
        local NFrame = Create("Frame", {
            Parent = NotifyHolder,
            BackgroundColor3 = Theme.Sidebar,
            Size = UDim2.new(1, 0, 0, 0),
            ClipsDescendants = true,
            Position = UDim2.new(1, 50, 0, 0)
        })
        Create("UICorner", {Parent = NFrame, CornerRadius = UDim.new(0, 10)})
        Create("UIStroke", {Parent = NFrame, Color = accentColor, Thickness = 1})
        
        -- Accent bar
        local AccentBar = Create("Frame", {
            Parent = NFrame,
            BackgroundColor3 = accentColor,
            Size = UDim2.new(0, 4, 1, 0),
            Position = UDim2.new(0, 0, 0, 0)
        })
        Create("UICorner", {Parent = AccentBar, CornerRadius = UDim.new(0, 2)})

        local NTitle = Create("TextLabel", {
            Parent = NFrame,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 16, 0, 12),
            Size = UDim2.new(1, -28, 0, 18),
            Font = Enum.Font.GothamBold,
            Text = NotifyConfig.Title or "Notification",
            TextColor3 = Theme.Text,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left
        })

        local NContent = Create("TextLabel", {
            Parent = NFrame,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 16, 0, 32),
            Size = UDim2.new(1, -28, 0, 30),
            Font = Enum.Font.Gotham,
            Text = NotifyConfig.Content or "",
            TextColor3 = Theme.SubText,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true,
            TextYAlignment = Enum.TextYAlignment.Top
        })
        
        -- Progress bar
        local ProgressBar = Create("Frame", {
            Parent = NFrame,
            BackgroundColor3 = accentColor,
            Position = UDim2.new(0, 0, 1, -3),
            Size = UDim2.new(1, 0, 0, 3),
            BackgroundTransparency = 0.5
        })

        -- Animate in
        Tween(NFrame, {0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out}, {
            Size = UDim2.new(1, 0, 0, 75),
            Position = UDim2.new(0, 0, 0, 0)
        })
        
        local duration = NotifyConfig.Duration or 4
        Tween(ProgressBar, {duration, Enum.EasingStyle.Linear}, {Size = UDim2.new(0, 0, 0, 3)})

        task.delay(duration, function()
            Tween(NFrame, {0.3, Enum.EasingStyle.Quint}, {
                Position = UDim2.new(1, 50, 0, 0),
                BackgroundTransparency = 1
            })
            task.wait(0.3)
            NFrame:Destroy()
        end)
    end

    -- Minimize functionality
    function Library:ToggleMinimize()
        Library.Minimized = not Library.Minimized
        
        if Library.Minimized then
            Tween(MainFrame, {0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In}, {
                Size = UDim2.fromOffset(200, 50),
                BackgroundTransparency = 0.3
            })
            for _, child in pairs(MainFrame:GetChildren()) do
                if child:IsA("Frame") or child:IsA("ScrollingFrame") then
                    Tween(child, {0.2}, {BackgroundTransparency = 1})
                end
                if child:IsA("TextLabel") or child:IsA("TextButton") then
                    Tween(child, {0.2}, {TextTransparency = 1})
                end
            end
        else
            Tween(MainFrame, {0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out}, {
                Size = windowSize,
                BackgroundTransparency = 0
            })
            task.delay(0.2, function()
                for _, child in pairs(MainFrame:GetChildren()) do
                    if child:IsA("Frame") and child.Name ~= "Shadow" then
                        Tween(child, {0.3}, {BackgroundTransparency = 0})
                    end
                    if child:IsA("TextLabel") or child:IsA("TextButton") then
                        Tween(child, {0.3}, {TextTransparency = 0})
                    end
                end
            end)
        end
    end

    -- Keybind for minimize
    UserInputService.InputBegan:Connect(function(input, processed)
        if processed then return end
        if input.KeyCode == Library.MinimizeKey then
            Library:ToggleMinimize()
        end
    end)

    -- Dialog System
    function Library:Dialog(DialogConfig)
        local Blur = Create("BlurEffect", {
            Name = "CeriumDialogBlur",
            Parent = Lighting,
            Size = 0
        })

        local Overlay = Create("Frame", {
            Parent = ScreenGui,
            BackgroundColor3 = Color3.new(0, 0, 0),
            BackgroundTransparency = 1,
            Size = UDim2.fromScale(1, 1),
            ZIndex = 200
        })

        local Box = Create("Frame", {
            Parent = Overlay,
            BackgroundColor3 = Theme.Sidebar,
            Size = UDim2.fromOffset(IsMobile and 280 or 340, 160),
            Position = UDim2.fromScale(0.5, 0.5),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundTransparency = 1
        })
        Create("UICorner", {Parent = Box, CornerRadius = UDim.new(0, 12)})
        Create("UIStroke", {Parent = Box, Color = Theme.Accent, Thickness = 1, Transparency = 1})

        local DialogTitle = Create("TextLabel", {
            Parent = Box,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 20, 0, 18),
            Size = UDim2.new(1, -40, 0, 22),
            Font = Enum.Font.GothamBold,
            Text = DialogConfig.Title or "Dialog",
            TextColor3 = Theme.Text,
            TextSize = 16,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTransparency = 1
        })

        local DialogContent = Create("TextLabel", {
            Parent = Box,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 20, 0, 45),
            Size = UDim2.new(1, -40, 0, 50),
            Font = Enum.Font.Gotham,
            Text = DialogConfig.Content or "",
            TextColor3 = Theme.SubText,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true,
            TextYAlignment = Enum.TextYAlignment.Top,
            TextTransparency = 1
        })

        local BtnContainer = Create("Frame", {
            Parent = Box,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 20, 1, -55),
            Size = UDim2.new(1, -40, 0, 35)
        })
        Create("UIListLayout", {
            Parent = BtnContainer,
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Right,
            Padding = UDim.new(0, 10)
        })

        -- Animate in
        Tween(Blur, {0.4}, {Size = 24})
        Tween(Overlay, {0.4}, {BackgroundTransparency = 0.6})
        Tween(Box, {0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out}, {BackgroundTransparency = 0})
        Tween(Box:FindFirstChildOfClass("UIStroke"), {0.4}, {Transparency = 0})
        Tween(DialogTitle, {0.4}, {TextTransparency = 0})
        Tween(DialogContent, {0.4}, {TextTransparency = 0})

        for _, btn in pairs(DialogConfig.Buttons or {}) do
            local isPrimary = btn.Primary
            local ButtonObj = Create("TextButton", {
                Parent = BtnContainer,
                BackgroundColor3 = isPrimary and Theme.Accent or Theme.Element,
                Size = UDim2.new(0, 90, 1, 0),
                Text = btn.Title or "Button",
                Font = Enum.Font.GothamMedium,
                TextColor3 = Theme.Text,
                TextSize = 12,
                AutoButtonColor = false
            })
            Create("UICorner", {Parent = ButtonObj, CornerRadius = UDim.new(0, 8)})
            AddHoverEffect(ButtonObj, isPrimary and Theme.AccentDark or Theme.Hover, isPrimary and Theme.Accent or Theme.Element)

            ButtonObj.MouseButton1Click:Connect(function()
                if btn.Callback then
                    btn.Callback()
                end

                Tween(Blur, {0.3}, {Size = 0})
                Tween(Overlay, {0.3}, {BackgroundTransparency = 1})
                Tween(Box, {0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In}, {
                    BackgroundTransparency = 1,
                    Size = UDim2.fromOffset(IsMobile and 260 or 320, 140)
                })

                task.wait(0.3)
                Overlay:Destroy()
                Blur:Destroy()
            end)
        end
    end

    local Tabs = {}
    local FirstTab = true
    local Window = {Tabs = {}}

    function Window:SetMinimizeKey(key)
        Library.MinimizeKey = key
    end

    -- Compatibility for "Window:Dialog" call in your script
    function Window:Dialog(Config)
        Library:Dialog(Config)
    end
    
    -- Compatibility for "Window:SelectTab" call in your script
    function Window:SelectTab(index)
        if Window.Tabs[index] then
            Window.Tabs[index]()
        end
    end

    function Window:CreateTab(TabConfig)
        local TabName = TabConfig.Title or "Tab"
        local TabIcon = TabConfig.Icon or ""

        local TabBtn = Create("TextButton", {
            Parent = TabContainer,
            BackgroundColor3 = Theme.Background,
            Size = UDim2.new(1, 0, 0, IsMobile and 36 or 38),
            AutoButtonColor = false,
            Text = "",
            BackgroundTransparency = 1
        })
        Create("UICorner", {Parent = TabBtn, CornerRadius = UDim.new(0, 8)})
        
        -- Tab indicator
        local TabIndicator = Create("Frame", {
            Parent = TabBtn,
            BackgroundColor3 = Theme.Accent,
            Position = UDim2.new(0, 0, 0.2, 0),
            Size = UDim2.new(0, 3, 0.6, 0),
            BackgroundTransparency = 1
        })
        Create("UICorner", {Parent = TabIndicator, CornerRadius = UDim.new(0, 2)})

        local TabLabel = Create("TextLabel", {
            Parent = TabBtn,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -20, 1, 0),
            Position = UDim2.new(0, 14, 0, 0),
            Text = (TabIcon ~= "" and TabIcon .. "  " or "") .. TabName,
            Font = Enum.Font.GothamMedium,
            TextColor3 = Theme.SubText,
            TextSize = IsMobile and 12 or 13,
            TextXAlignment = Enum.TextXAlignment.Left
        })

        local TabPage = Create("ScrollingFrame", {
            Parent = ContentHolder,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            ScrollBarThickness = 3,
            ScrollBarImageColor3 = Theme.Accent,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            Visible = false,
            ScrollingDirection = Enum.ScrollingDirection.Y
        })
        Create("UIPadding", {
            Parent = TabPage,
            PaddingTop = UDim.new(0, 15),
            PaddingLeft = UDim.new(0, 15),
            PaddingRight = UDim.new(0, 15),
            PaddingBottom = UDim.new(0, 15)
        })
        
        local Layout = Create("UIListLayout", {
            Parent = TabPage,
            Padding = UDim.new(0, 10),
            SortOrder = Enum.SortOrder.LayoutOrder
        })

        Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            TabPage.CanvasSize = UDim2.new(0, 0, 0, Layout.AbsoluteContentSize.Y + 30)
        end)

        local function Activate()
            -- Deactivate all tabs
            for _, v in pairs(TabContainer:GetChildren()) do
                if v:IsA("TextButton") then
                    Tween(v, {0.25}, {BackgroundTransparency = 1})
                    local indicator = v:FindFirstChild("Frame")
                    if indicator then
                        Tween(indicator, {0.25}, {BackgroundTransparency = 1})
                    end
                    local label = v:FindFirstChild("TextLabel")
                    if label then
                        Tween(label, {0.25}, {TextColor3 = Theme.SubText})
                    end
                end
            end
            
            -- Hide all pages with animation
            for _, v in pairs(ContentHolder:GetChildren()) do
                if v:IsA("ScrollingFrame") and v.Visible then
                    Tween(v, {0.15}, {CanvasPosition = Vector2.new(0, 0)})
                    v.Visible = false
                end
            end

            -- Activate current tab
            Tween(TabBtn, {0.25}, {BackgroundTransparency = 0})
            TabBtn.BackgroundColor3 = Theme.Hover
            Tween(TabIndicator, {0.25}, {BackgroundTransparency = 0})
            Tween(TabLabel, {0.25}, {TextColor3 = Theme.Text})
            
            -- Show page with animation
            TabPage.Visible = true
            TabPage.CanvasPosition = Vector2.new(0, 0)
        end

        -- Add to Window tabs list for programmatic selection
        table.insert(Window.Tabs, Activate)

        TabBtn.MouseButton1Click:Connect(function()
            Activate()
        end)

        -- Touch support
        TabBtn.TouchTap:Connect(function()
            Activate()
        end)

        if FirstTab then
            task.delay(0.3, Activate)
            FirstTab = false
        end

        local Elements = {}

        function Elements:CreateSection(Title)
            local SFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 26)
            })

            local SText = Create("TextLabel", {
                Parent = SFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 2, 0, 0),
                Size = UDim2.new(0, 0, 1, 0),
                AutomaticSize = Enum.AutomaticSize.X,
                Font = Enum.Font.GothamBold,
                Text = Title:upper(),
                TextColor3 = Theme.SubText,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local Line = Create("Frame", {
                Parent = SFrame,
                BackgroundColor3 = Theme.Stroke,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 0, 0.5, 0),
                Size = UDim2.new(1, 0, 0, 1),
                ZIndex = 0
            })

            SText:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
                Line.Position = UDim2.new(0, SText.AbsoluteSize.X + 12, 0.5, 0)
                Line.Size = UDim2.new(1, -(SText.AbsoluteSize.X + 12), 0, 1)
            end)
        end

        function Elements:CreateButton(ButtonConfig)
            local BFrame = Create("TextButton", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44),
                AutoButtonColor = false,
                Text = "",
                ClipsDescendants = true
            })
            Create("UICorner", {Parent = BFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = BFrame, Color = Theme.Stroke, Thickness = 1})

            local BTitle = Create("TextLabel", {
                Parent = BFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 0),
                Size = UDim2.new(1, -28, 1, 0),
                Font = Enum.Font.GothamMedium,
                Text = ButtonConfig.Title or "Button",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            if ButtonConfig.Description then
                BTitle.Size = UDim2.new(0.6, 0, 1, 0)
                Create("TextLabel", {
                    Parent = BFrame,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0.6, 0, 0, 0),
                    Size = UDim2.new(0.4, -14, 1, 0),
                    Font = Enum.Font.Gotham,
                    Text = ButtonConfig.Description,
                    TextColor3 = Theme.SubText,
                    TextSize = 11,
                    TextXAlignment = Enum.TextXAlignment.Right
                })
            end

            local LastClick = 0
            AddHoverEffect(BFrame)

            local function onClick()
                local Now = tick()
                local CooldownTime = ButtonConfig.Cooldown or 0

                if (Now - LastClick) < CooldownTime then
                    Tween(BFrame, {0.15}, {BackgroundColor3 = Theme.Error})
                    task.wait(0.15)
                    Tween(BFrame, {0.3}, {BackgroundColor3 = Theme.Element})
                    return
                end

                LastClick = Now
                
                Tween(BFrame, {0.1}, {BackgroundColor3 = Theme.Active})
                task.wait(0.1)
                Tween(BFrame, {0.2}, {BackgroundColor3 = Theme.Element})

                if ButtonConfig.Callback then
                    task.spawn(ButtonConfig.Callback)
                end
            end

            BFrame.MouseButton1Click:Connect(onClick)
            BFrame.TouchTap:Connect(onClick)
        end

        function Elements:CreateToggle(Id, ToggleConfig)
            ToggleConfig = ToggleConfig or {}
            
            local Toggle = {
                Value = ToggleConfig.Default or false,
                Type = "Toggle",
                Callback = ToggleConfig.Callback,
                Changed = nil
            }

            local ToggleFrame = Create("TextButton", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44),
                AutoButtonColor = false,
                Text = "",
                ClipsDescendants = true
            })
            Create("UICorner", {Parent = ToggleFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = ToggleFrame, Color = Theme.Stroke, Thickness = 1})

            local TitleLabel = Create("TextLabel", {
                Parent = ToggleFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 0),
                Size = UDim2.new(1, -70, 1, 0),
                Font = Enum.Font.GothamMedium,
                Text = ToggleConfig.Title or "Toggle",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local Switch = Create("Frame", {
                Parent = ToggleFrame,
                BackgroundColor3 = Color3.fromRGB(40, 40, 45),
                Position = UDim2.new(1, -52, 0.5, -11),
                Size = UDim2.new(0, 40, 0, 22)
            })
            Create("UICorner", {Parent = Switch, CornerRadius = UDim.new(1, 0)})
            Create("UIStroke", {Parent = Switch, Color = Theme.Stroke, Thickness = 1})

            local Knob = Create("Frame", {
                Parent = Switch,
                BackgroundColor3 = Color3.fromRGB(180, 180, 180),
                Position = UDim2.new(0, 3, 0.5, -8),
                Size = UDim2.new(0, 16, 0, 16)
            })
            Create("UICorner", {Parent = Knob, CornerRadius = UDim.new(1, 0)})
            
            -- Knob glow effect
            local KnobGlow = Create("Frame", {
                Parent = Knob,
                BackgroundColor3 = Theme.Accent,
                Size = UDim2.new(1, 8, 1, 8),
                Position = UDim2.new(0, -4, 0, -4),
                BackgroundTransparency = 1,
                ZIndex = 0
            })
            Create("UICorner", {Parent = KnobGlow, CornerRadius = UDim.new(1, 0)})

            function Toggle:SetValue(Value)
                Value = not not Value
                Toggle.Value = Value

                local TargetSwitchColor = Value and Theme.Accent or Color3.fromRGB(40, 40, 45)
                local TargetKnobPos = Value and UDim2.new(1, -19, 0.5, -8) or UDim2.new(0, 3, 0.5, -8)
                local TargetKnobColor = Value and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(180, 180, 180)
                local TargetStrokeColor = Value and Theme.Accent or Theme.Stroke
                local TargetGlowTransparency = Value and 0.7 or 1

                Tween(Switch, {0.3, Enum.EasingStyle.Quint}, {BackgroundColor3 = TargetSwitchColor})
                Tween(Switch:FindFirstChildOfClass("UIStroke"), {0.3}, {Color = TargetStrokeColor})
                Tween(Knob, {0.3, Enum.EasingStyle.Quint}, {Position = TargetKnobPos, BackgroundColor3 = TargetKnobColor})
                Tween(KnobGlow, {0.3}, {BackgroundTransparency = TargetGlowTransparency})

                if Toggle.Callback then
                    task.spawn(function()
                        Toggle.Callback(Toggle.Value)
                    end)
                end

                if Toggle.Changed then
                    task.spawn(function()
                        Toggle.Changed(Toggle.Value)
                    end)
                end
            end

            function Toggle:OnChanged(Func)
                Toggle.Changed = Func
                if Func then 
                    task.spawn(function()
                        Func(Toggle.Value)
                    end)
                end
            end

            function Toggle:Destroy()
                ToggleFrame:Destroy()
                Library.Options[Id] = nil
            end

            local function onToggle()
                Toggle:SetValue(not Toggle.Value)
            end

            ToggleFrame.MouseButton1Click:Connect(onToggle)
            ToggleFrame.TouchTap:Connect(onToggle)

            AddHoverEffect(ToggleFrame)
            Toggle:SetValue(Toggle.Value)
            Library.Options[Id] = Toggle
            return Toggle
        end

        function Elements:CreateSlider(Id, SliderConfig)
            local SFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 58 or 54)
            })
            Create("UICorner", {Parent = SFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = SFrame, Color = Theme.Stroke, Thickness = 1})

            Create("TextLabel", {
                Parent = SFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 8),
                Size = UDim2.new(0.6, 0, 0, 18),
                Font = Enum.Font.GothamMedium,
                Text = SliderConfig.Title or "Slider",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local ValueLabel = Create("TextLabel", {
                Parent = SFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0.6, 0, 0, 8),
                Size = UDim2.new(0.4, -14, 0, 18),
                Font = Enum.Font.GothamBold,
                Text = tostring(SliderConfig.Default or SliderConfig.Min),
                TextColor3 = Theme.Accent,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Right
            })

            local BarBg = Create("Frame", {
                Parent = SFrame,
                BackgroundColor3 = Color3.fromRGB(35, 35, 40),
                Position = UDim2.new(0, 14, 0, 34),
                Size = UDim2.new(1, -28, 0, 6)
            })
            Create("UICorner", {Parent = BarBg, CornerRadius = UDim.new(1, 0)})

            local Fill = Create("Frame", {
                Parent = BarBg,
                BackgroundColor3 = Theme.Accent,
                Size = UDim2.new(0, 0, 1, 0)
            })
            Create("UICorner", {Parent = Fill, CornerRadius = UDim.new(1, 0)})
            
            -- Fill glow
            local FillGlow = Create("Frame", {
                Parent = Fill,
                BackgroundColor3 = Theme.Accent,
                Size = UDim2.new(1, 0, 1, 4),
                Position = UDim2.new(0, 0, 0, -2),
                BackgroundTransparency = 0.7,
                ZIndex = 0
            })
            Create("UICorner", {Parent = FillGlow, CornerRadius = UDim.new(1, 0)})

            -- Slider knob
            local SliderKnob = Create("Frame", {
                Parent = BarBg,
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                Size = UDim2.new(0, 14, 0, 14),
                Position = UDim2.new(0, -7, 0.5, -7),
                ZIndex = 2
            })
            Create("UICorner", {Parent = SliderKnob, CornerRadius = UDim.new(1, 0)})
            Create("UIStroke", {Parent = SliderKnob, Color = Theme.Accent, Thickness = 2})

            local SliderBtn = Create("TextButton", {
                Parent = SFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = ""
            })

            local Min, Max = SliderConfig.Min or 0, SliderConfig.Max or 100
            local SObj = {Value = SliderConfig.Default or Min}

            local function Update(Input)
                local SizeX = math.clamp((Input.Position.X - BarBg.AbsolutePosition.X) / BarBg.AbsoluteSize.X, 0, 1)
                local NewValue = Min + ((Max - Min) * SizeX)
                
                if SliderConfig.Rounding then
                    NewValue = math.floor(NewValue * (10 ^ SliderConfig.Rounding)) / (10 ^ SliderConfig.Rounding)
                else
                    NewValue = math.floor(NewValue)
                end

                SObj.Value = NewValue
                ValueLabel.Text = tostring(NewValue)
                
                Tween(Fill, {0.08}, {Size = UDim2.new(SizeX, 0, 1, 0)})
                Tween(SliderKnob, {0.08}, {Position = UDim2.new(SizeX, -7, 0.5, -7)})

                if SliderConfig.Callback then
                    task.spawn(function()
                        SliderConfig.Callback(NewValue)
                    end)
                end
                if SObj.Callback then
                    task.spawn(function()
                        SObj.Callback(NewValue)
                    end)
                end
            end

            function SObj:SetValue(val)
                self.Value = math.clamp(val, Min, Max)
                local SizeX = (self.Value - Min) / (Max - Min)
                Tween(Fill, {0.2}, {Size = UDim2.new(math.clamp(SizeX, 0, 1), 0, 1, 0)})
                Tween(SliderKnob, {0.2}, {Position = UDim2.new(math.clamp(SizeX, 0, 1), -7, 0.5, -7)})
                ValueLabel.Text = tostring(self.Value)
            end

            function SObj:OnChanged(func)
                self.Callback = func
            end

            local Dragging = false
            
            SliderBtn.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = true
                    Update(input)
                    Tween(SliderKnob, {0.2}, {Size = UDim2.new(0, 18, 0, 18), Position = UDim2.new(SliderKnob.Position.X.Scale, -9, 0.5, -9)})
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if Dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    Update(input)
                end
            end)
            
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = false
                    Tween(SliderKnob, {0.2}, {Size = UDim2.new(0, 14, 0, 14), Position = UDim2.new(SliderKnob.Position.X.Scale, -7, 0.5, -7)})
                end
            end)

            SObj:SetValue(SObj.Value)
            Library.Options[Id] = SObj
            return SObj
        end

        function Elements:CreateDropdown(Id, DropdownConfig)
            local DFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44),
                ClipsDescendants = true
            })
            Create("UICorner", {Parent = DFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = DFrame, Color = Theme.Stroke, Thickness = 1})

            Create("TextLabel", {
                Parent = DFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 0),
                Size = UDim2.new(0.5, 0, 0, IsMobile and 48 or 44),
                Font = Enum.Font.GothamMedium,
                Text = DropdownConfig.Title or "Dropdown",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local ValueLabel = Create("TextLabel", {
                Parent = DFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0.4, 0, 0, 0),
                Size = UDim2.new(0.6, -40, 0, IsMobile and 48 or 44),
                Font = Enum.Font.Gotham,
                Text = "Select...",
                TextColor3 = Theme.SubText,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Right,
                TextTruncate = Enum.TextTruncate.AtEnd
            })

            local Arrow = Create("TextLabel", {
                Parent = DFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -30, 0, 0),
                Size = UDim2.new(0, 20, 0, IsMobile and 48 or 44),
                Font = Enum.Font.GothamBold,
                Text = "â–¼",
                TextColor3 = Theme.SubText,
                TextSize = 10,
                Rotation = 0
            })

            local Container = Create("Frame", {
                Parent = DFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 0, 0, IsMobile and 48 or 44),
                Size = UDim2.new(1, 0, 0, 0),
                ClipsDescendants = true
            })
            local DLayout = Create("UIListLayout", {
                Parent = Container,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 4)
            })
            Create("UIPadding", {
                Parent = Container,
                PaddingLeft = UDim.new(0, 8),
                PaddingRight = UDim.new(0, 8),
                PaddingTop = UDim.new(0, 6),
                PaddingBottom = UDim.new(0, 8)
            })

            local Open = false
            local DObj = {Value = DropdownConfig.Default, Values = DropdownConfig.Values or {}}

            local function Refresh()
                for _, v in pairs(Container:GetChildren()) do
                    if v:IsA("TextButton") then
                        v:Destroy()
                    end
                end

                for _, val in ipairs(DObj.Values) do
                    local IsSelected = false
                    if DropdownConfig.Multi then
                        if type(DObj.Value) == "table" and DObj.Value[val] then
                            IsSelected = true
                        end
                    else
                        if DObj.Value == val then
                            IsSelected = true
                        end
                    end

                    local Item = Create("TextButton", {
                        Parent = Container,
                        BackgroundColor3 = IsSelected and Theme.Accent or Theme.Background,
                        Size = UDim2.new(1, 0, 0, IsMobile and 36 or 32),
                        Text = "",
                        AutoButtonColor = false,
                        ClipsDescendants = true
                    })
                    Create("UICorner", {Parent = Item, CornerRadius = UDim.new(0, 6)})
                    
                    local ItemLabel = Create("TextLabel", {
                        Parent = Item,
                        BackgroundTransparency = 1,
                        Size = UDim2.new(1, -20, 1, 0),
                        Position = UDim2.new(0, 10, 0, 0),
                        Font = Enum.Font.Gotham,
                        Text = val,
                        TextColor3 = IsSelected and Color3.new(1, 1, 1) or Theme.SubText,
                        TextSize = 12,
                        TextXAlignment = Enum.TextXAlignment.Left
                    })
                    
                    if IsSelected then
                        Create("TextLabel", {
                            Parent = Item,
                            BackgroundTransparency = 1,
                            Size = UDim2.new(0, 20, 1, 0),
                            Position = UDim2.new(1, -25, 0, 0),
                            Font = Enum.Font.GothamBold,
                            Text = "âœ“",
                            TextColor3 = Color3.new(1, 1, 1),
                            TextSize = 12
                        })
                    end
                    
                    AddHoverEffect(Item, IsSelected and Theme.AccentDark or Theme.Hover, IsSelected and Theme.Accent or Theme.Background)

                    Item.MouseButton1Click:Connect(function()
                        if DropdownConfig.Multi then
                            if not DObj.Value then DObj.Value = {} end
                            DObj.Value[val] = not DObj.Value[val]
                        else
                            DObj.Value = val
                            Open = false
                            Tween(Arrow, {0.3, Enum.EasingStyle.Back}, {Rotation = 0})
                            Tween(DFrame, {0.3, Enum.EasingStyle.Quint}, {Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44)})
                        end
                        DObj:SetValue(DObj.Value)
                    end)
                end

                Container.Size = UDim2.new(1, 0, 0, DLayout.AbsoluteContentSize.Y + 14)
                if Open then
                    Tween(DFrame, {0.3, Enum.EasingStyle.Quint}, {Size = UDim2.new(1, 0, 0, (IsMobile and 48 or 44) + Container.Size.Y.Offset)})
                end
            end

            function DObj:SetValue(val)
                self.Value = val

                if DropdownConfig.Multi then
                    local t = {}
                    for k, v in pairs(val or {}) do
                        if v then table.insert(t, k) end
                    end
                    ValueLabel.Text = #t > 0 and table.concat(t, ", ") or "None"
                else
                    ValueLabel.Text = val and tostring(val) or "Select..."
                end

                Refresh()
                if self.Callback then
                    task.spawn(function()
                        self.Callback(val)
                    end)
                end
            end

            function DObj:SetValues(newVals)
                self.Values = newVals
                Refresh()
            end

            function DObj:OnChanged(func)
                self.Callback = func
            end

            local Trigger = Create("TextButton", {
                Parent = DFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44),
                Text = ""
            })
            
            Trigger.MouseButton1Click:Connect(function()
                Open = not Open
                Tween(Arrow, {0.3, Enum.EasingStyle.Back}, {Rotation = Open and 180 or 0})
                if not Open then
                    Tween(DFrame, {0.3, Enum.EasingStyle.Quint}, {Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44)})
                end
                Refresh()
            end)

            DObj:SetValue(DObj.Value)
            Library.Options[Id] = DObj
            return DObj
        end

        -- Enhanced Color Picker with HSV
        function Elements:CreateColorpicker(Id, ColorConfig)
            local CFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44),
                ClipsDescendants = true
            })
            Create("UICorner", {Parent = CFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = CFrame, Color = Theme.Stroke, Thickness = 1})

            Create("TextLabel", {
                Parent = CFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 0),
                Size = UDim2.new(0.5, 0, 0, IsMobile and 48 or 44),
                Font = Enum.Font.GothamMedium,
                Text = ColorConfig.Title or "Color",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local Preview = Create("Frame", {
                Parent = CFrame,
                BackgroundColor3 = ColorConfig.Default or Color3.new(1, 0, 0),
                Position = UDim2.new(1, -50, 0.5, -12),
                Size = UDim2.new(0, 36, 0, 24)
            })
            Create("UICorner", {Parent = Preview, CornerRadius = UDim.new(0, 6)})
            Create("UIStroke", {Parent = Preview, Color = Theme.Stroke, Thickness = 1})

            local CObj = {Value = ColorConfig.Default or Color3.new(1, 0, 0), Transparency = ColorConfig.Transparency or 0}
            local H, S, V = RGBtoHSV(CObj.Value)
            local Open = false

            local Container = Create("Frame", {
                Parent = CFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, IsMobile and 54 or 50),
                Size = UDim2.new(1, -20, 0, 180)
            })

            -- Saturation/Value picker
            local SVPicker = Create("ImageLabel", {
                Parent = Container,
                BackgroundColor3 = Color3.new(1, 0, 0),
                Position = UDim2.new(0, 0, 0, 0),
                Size = UDim2.new(1, -50, 0, 120),
                Image = "rbxassetid://4155801252"
            })
            Create("UICorner", {Parent = SVPicker, CornerRadius = UDim.new(0, 6)})

            local SVCursor = Create("Frame", {
                Parent = SVPicker,
                BackgroundColor3 = Color3.new(1, 1, 1),
                Size = UDim2.new(0, 12, 0, 12),
                Position = UDim2.new(S, -6, 1 - V, -6),
                AnchorPoint = Vector2.new(0.5, 0.5)
            })
            Create("UICorner", {Parent = SVCursor, CornerRadius = UDim.new(1, 0)})
            Create("UIStroke", {Parent = SVCursor, Color = Color3.new(0, 0, 0), Thickness = 2})

            -- Hue slider
            local HuePicker = Create("Frame", {
                Parent = Container,
                Position = UDim2.new(1, -35, 0, 0),
                Size = UDim2.new(0, 25, 0, 120)
            })
            Create("UICorner", {Parent = HuePicker, CornerRadius = UDim.new(0, 6)})
            Create("UIGradient", {
                Parent = HuePicker,
                Rotation = 90,
                Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
                    ColorSequenceKeypoint.new(0.167, Color3.fromRGB(255, 255, 0)),
                    ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0, 255, 0)),
                    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
                    ColorSequenceKeypoint.new(0.667, Color3.fromRGB(0, 0, 255)),
                    ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255, 0, 255)),
                    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
                })
            })

            local HueCursor = Create("Frame", {
                Parent = HuePicker,
                BackgroundColor3 = Color3.new(1, 1, 1),
                Size = UDim2.new(1, 4, 0, 6),
                Position = UDim2.new(0, -2, H, -3)
            })
            Create("UICorner", {Parent = HueCursor, CornerRadius = UDim.new(0, 3)})
            Create("UIStroke", {Parent = HueCursor, Color = Color3.new(0, 0, 0), Thickness = 1})

            -- RGB inputs
            local RGBContainer = Create("Frame", {
                Parent = Container,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 0, 0, 130),
                Size = UDim2.new(1, 0, 0, 28)
            })
            Create("UIListLayout", {
                Parent = RGBContainer,
                FillDirection = Enum.FillDirection.Horizontal,
                Padding = UDim.new(0, 6)
            })

            local function CreateRGBInput(label)
                local InputFrame = Create("Frame", {
                    Parent = RGBContainer,
                    BackgroundColor3 = Theme.Background,
                    Size = UDim2.new(0.32, -4, 1, 0)
                })
                Create("UICorner", {Parent = InputFrame, CornerRadius = UDim.new(0, 4)})
                
                Create("TextLabel", {
                    Parent = InputFrame,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(0, 20, 1, 0),
                    Font = Enum.Font.GothamBold,
                    Text = label,
                    TextColor3 = label == "R" and Color3.fromRGB(255, 100, 100) or (label == "G" and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(100, 150, 255)),
                    TextSize = 11
                })
                
                local Box = Create("TextBox", {
                    Parent = InputFrame,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 18, 0, 0),
                    Size = UDim2.new(1, -20, 1, 0),
                    Font = Enum.Font.Gotham,
                    Text = "255",
                    TextColor3 = Theme.Text,
                    TextSize = 11
                })
                
                return Box
            end

            local RInput = CreateRGBInput("R")
            local GInput = CreateRGBInput("G")
            local BInput = CreateRGBInput("B")

            -- Hex input
            local HexFrame = Create("Frame", {
                Parent = Container,
                BackgroundColor3 = Theme.Background,
                Position = UDim2.new(0, 0, 0, 164),
                Size = UDim2.new(1, 0, 0, 24)
            })
            Create("UICorner", {Parent = HexFrame, CornerRadius = UDim.new(0, 4)})

            Create("TextLabel", {
                Parent = HexFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(0, 25, 1, 0),
                Font = Enum.Font.GothamBold,
                Text = "#",
                TextColor3 = Theme.SubText,
                TextSize = 12
            })

            local HexInput = Create("TextBox", {
                Parent = HexFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 22, 0, 0),
                Size = UDim2.new(1, -24, 1, 0),
                Font = Enum.Font.Gotham,
                Text = "FF0000",
                TextColor3 = Theme.Text,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local function UpdateColor()
                CObj.Value = HSVtoRGB(H, S, V)
                Preview.BackgroundColor3 = CObj.Value
                SVPicker.BackgroundColor3 = HSVtoRGB(H, 1, 1)
                
                RInput.Text = tostring(math.floor(CObj.Value.R * 255))
                GInput.Text = tostring(math.floor(CObj.Value.G * 255))
                BInput.Text = tostring(math.floor(CObj.Value.B * 255))
                HexInput.Text = string.format("%02X%02X%02X", math.floor(CObj.Value.R * 255), math.floor(CObj.Value.G * 255), math.floor(CObj.Value.B * 255))
                
                if CObj.Callback then
                    task.spawn(function()
                        CObj.Callback(CObj.Value)
                    end)
                end
            end

            -- SV Picker interaction
            local svDragging = false
            local SVBtn = Create("TextButton", {Parent = SVPicker, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, 0), Text = ""})
            
            local function updateSV(input)
                local x = math.clamp((input.Position.X - SVPicker.AbsolutePosition.X) / SVPicker.AbsoluteSize.X, 0, 1)
                local y = math.clamp((input.Position.Y - SVPicker.AbsolutePosition.Y) / SVPicker.AbsoluteSize.Y, 0, 1)
                S = x
                V = 1 - y
                Tween(SVCursor, {0.05}, {Position = UDim2.new(S, 0, 1 - V, 0)})
                UpdateColor()
            end
            
            SVBtn.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    svDragging = true
                    updateSV(input)
                end
            end)

            -- Hue picker interaction
            local hueDragging = false
            local HueBtn = Create("TextButton", {Parent = HuePicker, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, 0), Text = ""})
            
            local function updateHue(input)
                local y = math.clamp((input.Position.Y - HuePicker.AbsolutePosition.Y) / HuePicker.AbsoluteSize.Y, 0, 1)
                H = y
                Tween(HueCursor, {0.05}, {Position = UDim2.new(0, -2, H, -3)})
                UpdateColor()
            end
            
            HueBtn.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    hueDragging = true
                    updateHue(input)
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    if svDragging then updateSV(input) end
                    if hueDragging then updateHue(input) end
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    svDragging = false
                    hueDragging = false
                end
            end)

            -- RGB input handlers
            local function updateFromRGB()
                local r = tonumber(RInput.Text) or 0
                local g = tonumber(GInput.Text) or 0
                local b = tonumber(BInput.Text) or 0
                r = math.clamp(r, 0, 255) / 255
                g = math.clamp(g, 0, 255) / 255
                b = math.clamp(b, 0, 255) / 255
                H, S, V = RGBtoHSV(Color3.new(r, g, b))
                Tween(SVCursor, {0.1}, {Position = UDim2.new(S, 0, 1 - V, 0)})
                Tween(HueCursor, {0.1}, {Position = UDim2.new(0, -2, H, -3)})
                UpdateColor()
            end
            
            RInput.FocusLost:Connect(updateFromRGB)
            GInput.FocusLost:Connect(updateFromRGB)
            BInput.FocusLost:Connect(updateFromRGB)

            -- Hex input handler
            HexInput.FocusLost:Connect(function()
                local hex = HexInput.Text:gsub("#", "")
                if #hex == 6 then
                    local r = tonumber(hex:sub(1, 2), 16) or 0
                    local g = tonumber(hex:sub(3, 4), 16) or 0
                    local b = tonumber(hex:sub(5, 6), 16) or 0
                    H, S, V = RGBtoHSV(Color3.new(r/255, g/255, b/255))
                    Tween(SVCursor, {0.1}, {Position = UDim2.new(S, 0, 1 - V, 0)})
                    Tween(HueCursor, {0.1}, {Position = UDim2.new(0, -2, H, -3)})
                    UpdateColor()
                end
            end)

            local Trigger = Create("TextButton", {
                Parent = CFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44),
                Text = ""
            })
            
            Trigger.MouseButton1Click:Connect(function()
                Open = not Open
                Tween(CFrame, {0.35, Enum.EasingStyle.Quint}, {Size = UDim2.new(1, 0, 0, Open and (IsMobile and 250 or 240) or (IsMobile and 48 or 44))})
            end)

            function CObj:OnChanged(func)
                self.Callback = func
            end
            
            function CObj:SetValueRGB(val)
                self.Value = val
                H, S, V = RGBtoHSV(val)
                Preview.BackgroundColor3 = val
                SVPicker.BackgroundColor3 = HSVtoRGB(H, 1, 1)
                SVCursor.Position = UDim2.new(S, 0, 1 - V, 0)
                HueCursor.Position = UDim2.new(0, -2, H, -3)
                UpdateColor()
            end

            -- Initialize with default color
            H, S, V = RGBtoHSV(CObj.Value)
            UpdateColor()

            Library.Options[Id] = CObj
            return CObj
        end

        function Elements:CreateKeybind(Id, KeybindConfig)
            local KFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44)
            })
            Create("UICorner", {Parent = KFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = KFrame, Color = Theme.Stroke, Thickness = 1})

            Create("TextLabel", {
                Parent = KFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 0),
                Size = UDim2.new(0.5, 0, 1, 0),
                Font = Enum.Font.GothamMedium,
                Text = KeybindConfig.Title or "Keybind",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local BindBtn = Create("TextButton", {
                Parent = KFrame,
                BackgroundColor3 = Theme.Background,
                Position = UDim2.new(1, -100, 0.5, -13),
                Size = UDim2.new(0, 86, 0, 26),
                Font = Enum.Font.Gotham,
                Text = KeybindConfig.Default or "None",
                TextColor3 = Theme.SubText,
                TextSize = 12,
                AutoButtonColor = false
            })
            Create("UICorner", {Parent = BindBtn, CornerRadius = UDim.new(0, 6)})
            Create("UIStroke", {Parent = BindBtn, Color = Theme.Stroke, Thickness = 1})
            AddHoverEffect(BindBtn, Theme.Hover, Theme.Background)

            local KObj = {Value = KeybindConfig.Default, Mode = KeybindConfig.Mode or "Toggle", Toggled = false}
            local Binding = false

            BindBtn.MouseButton1Click:Connect(function()
                Binding = true
                BindBtn.Text = "..."
                Tween(BindBtn, {0.2}, {BackgroundColor3 = Theme.Accent})
                Tween(BindBtn:FindFirstChildOfClass("UIStroke"), {0.2}, {Color = Theme.Accent})
                BindBtn.TextColor3 = Color3.new(1, 1, 1)
            end)

            UserInputService.InputBegan:Connect(function(input)
                if Binding and input.UserInputType == Enum.UserInputType.Keyboard then
                    KObj.Value = input.KeyCode.Name
                    BindBtn.Text = KObj.Value
                    Tween(BindBtn, {0.2}, {BackgroundColor3 = Theme.Background})
                    Tween(BindBtn:FindFirstChildOfClass("UIStroke"), {0.2}, {Color = Theme.Stroke})
                    BindBtn.TextColor3 = Theme.SubText
                    Binding = false
                    
                    if KeybindConfig.ChangedCallback then
                        task.spawn(function()
                            KeybindConfig.ChangedCallback(input.KeyCode)
                        end)
                    end
                elseif not Binding and input.KeyCode.Name == KObj.Value then
                    KObj.Toggled = not KObj.Toggled
                    if KeybindConfig.Callback then
                        task.spawn(function()
                            KeybindConfig.Callback(KObj.Toggled)
                        end)
                    end
                    if KObj.OnClickCallback then
                        task.spawn(KObj.OnClickCallback)
                    end
                end
            end)

            function KObj:OnClick(func)
                self.OnClickCallback = func
            end

            function KObj:OnChanged(func)
                self.ChangedCallback = func
            end

            function KObj:GetState()
                return self.Toggled
            end
            
            function KObj:SetValue(key)
                self.Value = key
                BindBtn.Text = key
            end

            Library.Options[Id] = KObj
            return KObj
        end

        function Elements:CreateInput(Id, InputConfig)
            local IFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 48 or 44)
            })
            Create("UICorner", {Parent = IFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = IFrame, Color = Theme.Stroke, Thickness = 1})

            Create("TextLabel", {
                Parent = IFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 0),
                Size = UDim2.new(0.4, 0, 1, 0),
                Font = Enum.Font.GothamMedium,
                Text = InputConfig.Title or "Input",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local InputBox = Create("TextBox", {
                Parent = IFrame,
                BackgroundColor3 = Theme.Background,
                Position = UDim2.new(1, -170, 0.5, -14),
                Size = UDim2.new(0, 156, 0, 28),
                Font = Enum.Font.Gotham,
                Text = InputConfig.Default or "",
                PlaceholderText = InputConfig.Placeholder or "Enter text...",
                TextColor3 = Theme.Text,
                PlaceholderColor3 = Theme.SubText,
                TextSize = 12,
                ClearTextOnFocus = false
            })
            Create("UICorner", {Parent = InputBox, CornerRadius = UDim.new(0, 6)})
            Create("UIStroke", {Parent = InputBox, Color = Theme.Stroke, Thickness = 1})

            local IObj = {Value = InputConfig.Default or ""}

            InputBox.Focused:Connect(function()
                Tween(InputBox:FindFirstChildOfClass("UIStroke"), {0.2}, {Color = Theme.Accent})
            end)
            
            InputBox.FocusLost:Connect(function()
                Tween(InputBox:FindFirstChildOfClass("UIStroke"), {0.2}, {Color = Theme.Stroke})
                IObj.Value = InputBox.Text
                if InputConfig.Callback then
                    task.spawn(function()
                        InputConfig.Callback(InputBox.Text)
                    end)
                end
                if IObj.Callback then
                    task.spawn(function()
                        IObj.Callback(InputBox.Text)
                    end)
                end
            end)

            function IObj:OnChanged(func)
                self.Callback = func
            end
            
            function IObj:SetValue(val)
                InputBox.Text = val
                IObj.Value = val
            end

            Library.Options[Id] = IObj
            return IObj
        end
        
        -- Vector3 Method (Fixed: Added as it was missing)
        function Elements:CreateVector3(Id, VecConfig)
            local VFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 68 or 64)
            })
            Create("UICorner", {Parent = VFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = VFrame, Color = Theme.Stroke, Thickness = 1})

            Create("TextLabel", {
                Parent = VFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 8),
                Size = UDim2.new(1, -28, 0, 20),
                Font = Enum.Font.GothamMedium,
                Text = VecConfig.Title or "Vector3",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local Container = Create("Frame", {
                Parent = VFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 32),
                Size = UDim2.new(1, -28, 0, 24)
            })
            
            Create("UIListLayout", {
                Parent = Container,
                FillDirection = Enum.FillDirection.Horizontal,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 6)
            })
            
            local function CreateVecInput(Label, Default)
                local InputFrame = Create("Frame", {
                    Parent = Container,
                    BackgroundColor3 = Theme.Background,
                    Size = UDim2.new(0.33, -4, 1, 0)
                })
                Create("UICorner", {Parent = InputFrame, CornerRadius = UDim.new(0, 4)})
                Create("UIStroke", {Parent = InputFrame, Color = Theme.Stroke, Thickness = 1})
                
                Create("TextLabel", {
                    Parent = InputFrame,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(0, 16, 1, 0),
                    Font = Enum.Font.GothamBold,
                    Text = Label,
                    TextColor3 = Label == "X" and Color3.fromRGB(255, 100, 100) or (Label == "Y" and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(100, 150, 255)),
                    TextSize = 11
                })
                
                local Box = Create("TextBox", {
                    Parent = InputFrame,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 16, 0, 0),
                    Size = UDim2.new(1, -18, 1, 0),
                    Font = Enum.Font.Gotham,
                    Text = tostring(Default or 0),
                    TextColor3 = Theme.Text,
                    TextSize = 11
                })
                return Box, InputFrame
            end
            
            local Def = VecConfig.Default or Vector3.new(0, 0, 0)
            local BoxX, FrameX = CreateVecInput("X", Def.X)
            local BoxY, FrameY = CreateVecInput("Y", Def.Y)
            local BoxZ, FrameZ = CreateVecInput("Z", Def.Z)
            
            local function UpdateVector()
                local x, y, z = tonumber(BoxX.Text) or 0, tonumber(BoxY.Text) or 0, tonumber(BoxZ.Text) or 0
                local vec = Vector3.new(x, y, z)
                
                if VecConfig.Callback then
                    task.spawn(function()
                        VecConfig.Callback(vec)
                    end)
                end
            end
            
            for _, box in pairs({BoxX, BoxY, BoxZ}) do
                box.FocusLost:Connect(function()
                    UpdateVector()
                    Tween(box.Parent:FindFirstChildOfClass("UIStroke"), {0.2}, {Color = Theme.Stroke})
                end)
                box.Focused:Connect(function()
                    Tween(box.Parent:FindFirstChildOfClass("UIStroke"), {0.2}, {Color = Theme.Accent})
                end)
            end
            
            Library.Options[Id] = {
                SetValue = function(self, newVec)
                    BoxX.Text = tostring(newVec.X)
                    BoxY.Text = tostring(newVec.Y)
                    BoxZ.Text = tostring(newVec.Z)
                end
            }
        end

        function Elements:CreateLabel(LabelConfig)
            local LFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 40 or 38)
            })
            Create("UICorner", {Parent = LFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = LFrame, Color = Theme.Stroke, Thickness = 1})

            local TitleLabel = Create("TextLabel", {
                Parent = LFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 14, 0, 0),
                Size = UDim2.new(0.5, 0, 1, 0),
                Font = Enum.Font.GothamMedium,
                Text = LabelConfig.Title or "Label",
                TextColor3 = Theme.Text,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local ValueText = Create("TextLabel", {
                Parent = LFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0.5, 0, 0, 0),
                Size = UDim2.new(0.5, -14, 1, 0),
                Font = Enum.Font.Gotham,
                Text = LabelConfig.Value or "",
                TextColor3 = Theme.Accent,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Right
            })

            local LObj = {}
            function LObj:Set(val)
                ValueText.Text = tostring(val)
            end
            return LObj
        end

        function Elements:CreateParagraph(Id, ParagraphConfig)
            local PFrame = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y
            })
            Create("UICorner", {Parent = PFrame, CornerRadius = UDim.new(0, 8)})
            Create("UIStroke", {Parent = PFrame, Color = Theme.Stroke, Thickness = 1})
            Create("UIPadding", {
                Parent = PFrame,
                PaddingTop = UDim.new(0, 14),
                PaddingBottom = UDim.new(0, 14),
                PaddingLeft = UDim.new(0, 14),
                PaddingRight = UDim.new(0, 14)
            })
            Create("UIListLayout", {Parent = PFrame, Padding = UDim.new(0, 6), SortOrder = Enum.SortOrder.LayoutOrder})

            local PTitle = Create("TextLabel", {
                Parent = PFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                Font = Enum.Font.GothamBold,
                Text = ParagraphConfig.Title or "Paragraph",
                TextColor3 = Theme.Text,
                TextSize = 14,
                TextXAlignment = ParagraphConfig.TitleAlignment or Enum.TextXAlignment.Left
            })

            local PContent = Create("TextLabel", {
                Parent = PFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                Font = Enum.Font.Gotham,
                Text = ParagraphConfig.Content or "",
                TextColor3 = Theme.SubText,
                TextSize = 12,
                TextXAlignment = ParagraphConfig.ContentAlignment or Enum.TextXAlignment.Left,
                TextWrapped = true
            })

            local ParaObj = {Value = ParagraphConfig.Content}
            function ParaObj:SetValue(val)
                PContent.Text = val
                self.Value = val
            end
            Library.Options[Id] = ParaObj
            return ParaObj
        end

        function Elements:CreateProfileCard(ProfileConfig)
            ProfileConfig = ProfileConfig or {}
            local TitleText = ProfileConfig.Title or Players.LocalPlayer.DisplayName
            local SubText = ProfileConfig.Content or "@" .. Players.LocalPlayer.Name .. "  â€¢  ID: " .. Players.LocalPlayer.UserId

            local Card = Create("Frame", {
                Parent = TabPage,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, IsMobile and 68 or 64)
            })
            Create("UICorner", {Parent = Card, CornerRadius = UDim.new(0, 10)})
            Create("UIStroke", {Parent = Card, Color = Theme.Stroke, Thickness = 1})

            local Avatar = Create("ImageLabel", {
                Parent = Card,
                BackgroundColor3 = Theme.Background,
                Position = UDim2.new(0, 12, 0, 12),
                Size = UDim2.new(0, 40, 0, 40),
                Image = ""
            })
            Create("UICorner", {Parent = Avatar, CornerRadius = UDim.new(1, 0)})
            Create("UIStroke", {Parent = Avatar, Color = Theme.Accent, Thickness = 2})

            task.spawn(function()
                local success, content = pcall(function()
                    return Players:GetUserThumbnailAsync(
                        Players.LocalPlayer.UserId,
                        Enum.ThumbnailType.HeadShot,
                        Enum.ThumbnailSize.Size150x150
                    )
                end)
                if success then
                    Avatar.Image = content
                end
            end)

            Create("TextLabel", {
                Parent = Card,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 64, 0, 12),
                Size = UDim2.new(1, -76, 0, 20),
                Font = Enum.Font.GothamBold,
                Text = TitleText,
                TextColor3 = Theme.Text,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            Create("TextLabel", {
                Parent = Card,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 64, 0, 34),
                Size = UDim2.new(1, -76, 0, 18),
                Font = Enum.Font.Gotham,
                Text = SubText,
                TextColor3 = Theme.SubText,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextTruncate = Enum.TextTruncate.AtEnd
            })
        end

        Elements.AddDropdown = Elements.CreateDropdown
        Elements.AddToggle = Elements.CreateToggle
        Elements.AddButton = Elements.CreateButton
        Elements.AddSlider = Elements.CreateSlider

        return Elements
    end

    return Window
end

-- Compatibility stubs
local SaveManager = {}
local InterfaceManager = {}

function SaveManager:SetLibrary(lib) end
function SaveManager:IgnoreThemeSettings() end
function SaveManager:SetIgnoreIndexes(tbl) end
function SaveManager:SetFolder(folder) end
function SaveManager:BuildConfigSection(tab)
    tab:CreateParagraph("SaveMgr", {Title = "Save Manager", Content = "Configuration saving coming soon."})
end
function SaveManager:LoadAutoloadConfig() end

function InterfaceManager:SetLibrary(lib) end
function InterfaceManager:SetFolder(folder) end
function InterfaceManager:BuildInterfaceSection(tab)
    tab:CreateParagraph("IntMgr", {Title = "Interface Manager", Content = "Interface settings coming soon."})
end

return Library
